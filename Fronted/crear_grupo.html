<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SplitPay - Crear Grupo</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Inter -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #F7F9FB;
      color: #2B2B2B;
    }
    .btn-primary {
      background-color: #2979FF;
      color: #FFFFFF;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }
    .btn-primary:hover {
      background-color: #1a62cc;
    }
    .btn-secondary {
      background-color: #FFFFFF;
      color: #2B2B2B;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 500;
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }
    .btn-secondary:hover {
      background-color: #F0F2F5;
      border-color: #D1D5DB;
    }
    .card {
      background-color: #FFFFFF;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 24px;
    }
    .input-field {
      border-radius: 8px;
      border: 1px solid #E5E7EB;
      padding: 10px 16px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.02);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      width: 100%;
    }
    .input-field:focus {
      outline: none;
      border-color: #2979FF;
      box-shadow: 0 0 0 3px rgba(41, 121, 255, 0.2);
    }
    .select-field {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%236B7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 0.8em;
      padding-right: 2.5rem;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4">
  <div class="card w-full max-w-lg mx-auto">
    <h1 class="text-2xl font-semibold mb-6 text-center">Crear nuevo grupo</h1>

    <form id="create-group-form" class="space-y-4">
      <div>
        <label for="group-name" class="block text-sm font-medium mb-1">Nombre del grupo</label>
        <input
          type="text"
          id="group-name"
          placeholder="Ej. Viaje a Cusco 2024"
          class="input-field"
        />
      </div>

      <!-- Campos adicionales solo visuales por ahora -->
      <div>
        <label for="group-type" class="block text-sm font-medium mb-1">Tipo de grupo</label>
        <select id="group-type" class="input-field select-field">
          <option value="">Selecciona el tipo</option>
          <option value="travel">Viaje</option>
          <option value="roommates">Roommates</option>
          <option value="family">Familia</option>
          <option value="project">Proyecto</option>
          <option value="other">Otro</option>
        </select>
      </div>

      <div>
        <label for="currency" class="block text-sm font-medium mb-1">Moneda</label>
        <select id="currency" class="input-field select-field">
          <option value="PEN">PEN (Soles)</option>
          <option value="USD">USD (Dólares)</option>
        </select>
      </div>

      <div>
        <label for="members" class="block text-sm font-medium mb-1">Miembros (emails)</label>
        <textarea
          id="members"
          rows="3"
          placeholder="Ingresa emails separados por comas o uno por línea (por ahora solo informativo)"
          class="input-field resize-y"
        ></textarea>
        <p class="text-xs text-gray-500 mt-1">
          En el MVP solo crearemos el grupo con el nombre. La gestión de miembros vendrá después.
        </p>
      </div>

      <p id="create-group-error" class="text-sm text-red-500 pt-1 hidden">
        No se pudo crear el grupo. Inténtalo de nuevo.
      </p>
    </form>

    <div class="flex justify-end space-x-3 mt-8">
      <!-- VOLVER AL DASHBOARD -->
      <a href="dashboard.html">
        <button type="button" class="btn-secondary">Cancelar</button>
      </a>
      <button id="create-group-button" type="button" class="btn-primary">Crear grupo</button>
    </div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:8000"; // misma base que en index/dashboard

    const form = document.getElementById("create-group-form");
    const nameInput = document.getElementById("group-name");
    const errorText = document.getElementById("create-group-error");
    const createButton = document.getElementById("create-group-button");

    function getToken() {
      return localStorage.getItem("splitpay_token");
    }

    function requireAuth() {
      const token = getToken();
      if (!token) {
        window.location.href = "index.html";
      }
      return token;
    }

    async function createGroup() {
      errorText.classList.add("hidden");
      const token = requireAuth();

      const name = nameInput.value.trim();
      if (!name) {
        errorText.textContent = "Introduce un nombre para el grupo.";
        errorText.classList.remove("hidden");
        return;
      }

      try {
        const resp = await fetch(`${API_BASE}/groups`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({ name }),
        });

        if (!resp.ok) {
          const body = await resp.json().catch(() => null);
          errorText.textContent = body?.detail || "No se pudo crear el grupo.";
          errorText.classList.remove("hidden");
          return;
        }

        const group = await resp.json();
        window.location.href = `grupo.html?groupId=${group.id}`;
      } catch (err) {
        console.error(err);
        errorText.textContent = "No se pudo conectar con el servidor.";
        errorText.classList.remove("hidden");
      }
    }

    createButton.addEventListener("click", createGroup);
  </script>
</body>
</html>
